### 📌Chapter3-商品系统

#### 🔻系统概述和难点
        🔸概述：商品系统主要功能是商品列表、商品详情
        
        🔸难点：
       
           🔹高并发查询:高并发读(商品详情页是整个系统DAU最高的页面之一)
       
           🔹数据体量大:商品详细页包含非常多信息
       
           🔹数据数量多:一个sku对应多个skuSn 可能有几个亿的sku

#### 🔻解决方法
        🔸问题的核心：高并发场景下 体积大 内容杂的商品详情的数据读取方案
       
           🔹高并发读:逐步降低流量大小 从前端 网关 Nginx
       
           🔹缓存: 前端静态化、本地缓存、分布式缓存、多级缓存等
       
           🔹异步化: 非核心信息 异步化读取 如:推荐、猜你喜欢等
       
           🔹预先准备: 提前准备 或者计算 变化不多的数据
       
           🔹虚假流量:黄牛抢票 风控
       
           🔹避免单点: 服务集群化、分布式化
       
           🔹高可用: 熔断限流降级 快速恢复 快速转移 预警 责任心等等

#### 🔻商品基本信息
      🔸数据内容: 主标题、副标题、价格颜色等
       
      🔸数据特征: 
       
           🔹数据固定 不容易变化
       
           🔹数据体积不大
       
           🔹比较核心的数据
       
      🔸数据操作: 读请求
       
      🔸存储方式: 
       
           🔹MySQL中存储:逐步降低流量大小 从前端 网关 Nginx
       
           🔹使用缓存: 本地缓存、分布式缓存、多级缓存等
       
      🔸注意事项: 
       
           🔹缓存一致性问题:一般采用Cache Aside 更新数据库后删除缓存
       
           🔹历史表: 保存商品信息快照 为了解决变化的商品信息 方便后续其他领域回滚正确等操作
       
           🔹历史版本: 为了解决商品信息的变化而影响其他领域 表中加记录的版本号 如创建订单的价格和最终支付的钱不一致

#### 🔻商品参数信息
      🔸数据内容: 商品的特征信息(大小 尺寸等)
       
      🔸数据特征: 
       
           🔹数据不固定 千品千面
       
           🔹数据体积小但是内容杂 
       
           🔹比较核心的数据
       
      🔸数据操作: 读请求 不需要对其进行聚合操作
       
      🔸存储方式: 
       
           🔹MySQL中存储:存储JSON
       
           🔹使用中间件*: MongoDB

#### 🔻图片和视频信息
      🔸数据内容: 商品的补充描述信息:商品图片 商品视频
       
      🔸数据特征: 
       
           🔹数据体积大 内容杂
       
           🔹次核心的数据
       
      🔸数据操作: 读请求 通过图片id或者视频id去查询
       
      🔸存储方式: 
       
           🔹云服务:使用OSS云存储➕CDN

#### 🔻商品介绍信息
      🔸数据内容: 商品的介绍信息
       
      🔸数据特征: 
       
           🔹数据固定 数据变化不频繁
       
           🔹每个sku对应的商品都是一样的介绍
       
      🔸数据操作: 读请求
       
      🔸存储方式: 
       
           🔹前端静态化:使用前端静态化进行存储 采用预先生成数据的方式 提前准备好

#### 🔻总结
    🔸高并发场景的解决思路之一主要是分治：通过分析查询的数据特征 将数据存入合适的介质 方便查询
   
    🔸核心数据存入MySQL持久化 常用数据使用中间件(MongoDB、Redis等)、云服务(OSS)或者其前端静态化

#### 🔻泛化
    🔸高并发场景的解决思路之一主要是分治
   
    🔸高并发读的解决方案：缓存、异步化、预热、高性能中间件(Redis)、提前准备数据、避免单点等
   
    🔸实际问题中要考虑到性能、数据一致性、服务击穿、引入一个中间件带来的代价等

#### 🔻实践
    🔸使用过多级缓存解决高并发库存读取问题
   
    🔸使用过Redis➕Lua脚本解决高并发库存扣件问题
   
    🔸使用定时任务进行缓存预热
   
    🔸使用定时任务对需要的数据提前进行计算